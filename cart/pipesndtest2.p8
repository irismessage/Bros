pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
function _update()
	if (done) stop("done")
	sndplaying()
end

rate = 5512

period = 256
hz = 31960.4 / period
lcn = hz / rate
i = 1
--duration = 40
duration = 400

usrdta = 0x4300
adr = usrdta
dtalen = 2048
dtaend = usrdta+dtalen
done = false


function sndplaying()
	-- update playing sample snd
	-- returns true if snd playing
	-- skip by pressing ‚ùé
	-- uses sndp table

	-- wait for buffer
	if stat(108) != 0 then
		return
	end

	-- fill memory
	while 0 < period do
		
		while i < duration do
			local sign = sgn(sin(lcn*i))
			local sam = sign*63 + 128
			i += 1
			poke(adr,sam)
			adr += 1
			if adr == dtaend then
				adr = usrdta
				-- play if full
				serial(0x808,usrdta,dtalen)
				return
			end
		end

		period -= 1
		hz = 31960.4 / period
		lcn = hz / rate
		i = 0
	end

	local remains = adr-usrdta
	serial(0x808,usrdta,remains)
	done = true
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
