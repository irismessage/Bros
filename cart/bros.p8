pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--bros is 120x169px
--15x21 sprites

g = {
	score=0,
	coins=0,
	lives=3,
	lvl=11,
	timer=600,
	wep=0,
}

p = {
	x=0,
	y=0,
	jump=0,
}

scoresn={}
scoresc={}

function _init()
	cls(1)
	load_font()
	--mainscreen()
	scorescreen()
end

function _update()
	g.timer -= 1
end

function _draw()
	scorebarl()
end

function mainscreen()
	cls(1)
	map(0)
	scorebars()
	--âŽðŸ…¾ï¸
	print("x:play",8,104)
	print("pause:screen",38,104)
	print("o:scores",92,104)
end

function scorescreen()
	cls(1)
	scorebars()
	print("h i g h s c o r e s :", 20, 24)	
end

function loadscores()
	--data layout
	--00 to 09 top scores
	--10 to 29 names
	--three nums per name
	cartdata("bros_sorb")
	for i=0,9 do
		scoresn[i+1] = dget(i)
	end
	for i=10,29 do
		n = dget(i)
		if n == 0 then
			n = 32
			dset(i,n)
		end
		c = chr(n)
		scoresc[i-9] = c
	end
end

function rankscore(score)
	for i=0,9 do
		if score > scoresn[i] then
			return i
		end
	end
	return 10
end

function sprtochar(sprn)
	--sprn is sprite number
	char = {}
	col = sprn % 16
	row = flr(sprn / 16)
	x = col * 8
	y = row * 8
	for i=0,7 do
		a = i + 1
		char[a] = 0
		for j=0,7 do
			if sget(x+j, y+i) == 0 then
				char[a] = char[a] | 2^j 
			end
		end
	end
	return char
end

function fblock(src, dest, len)
	--font copy block
	--src is sprite number
	--dest is p8scii code
	daddr = 0x5600 + dest * 8
	for i=1,len do
		char = sprtochar(src)
		poke(daddr, unpack(char))
		src += 1
		daddr += 8
	end
end

function load_font()
	--load custom font from sprite
	-- sheet and activate it
	
	--letters
	fblock(49, 97, 26)
	--numbers
	fblock(81, 48, 10)
	--symbols
	fblock(97, 58, 1)
	
	--switch and metadata
	color(15)
	poke(0x5f58, 0x1 | 0x80)
	poke(0x5600, 4)
	poke(0x5602, 8)
end

function pad(num, digits)
	padded = tostr(num)
	diff = digits - #padded
	if diff > 0 then
		for i=1,diff do
			padded = "0"..padded
		end
	end
	return padded
end

function scorebars()
	--draw top bar static part
	spr(33, 24, 8)
	spr(34, 42, 8)
	print("lvl"..g.lvl,60,8)
	spr(35, 82, 8)
	spr(36, 106, 8)
end

function clearbar(x, len)
	for i=x,x+len do
		spr(1,i,8)
	end
end

function scorebarl()
	--draw top bar live part
	clearbar(4,5)
	print(pad(g.score,5),4,8)
	clearbar(32,2)
	print(pad(g.coins,2),32,8)
	spr(1,52,8)
	print(g.lives,52,8)
	clearbar(90,3)
	print(pad(g.timer,3),90,8)
	clearbar(114,2)
	print(pad(g.wep,2),114,8)
end

__gfx__
00000000111111111112221111222111144114411411114111141411111111111111111111111111111111117777777777777777777777777777777777777777
00000000111111111122222212222221122112211411114111141411114111411141114114111141114114117777777777777777777777777777777777777777
00700700111111111114044111404411142222411414144114141411140414041404140411411411114114117777777777777777777777777777777777777777
00077000111111111114411111441111100000011414144114141441124222411242224112422421124224217777777777777777777777777777777777777777
00077000111111111000000104000041111441114040404140404041222222222222222222222222222222227777777777777777777777777777777777777777
00700700111111111422224112222111114444114404000440000004122222211222222112222221122222217777777777777777777777777777777777777777
00000000111111111221122122112211122222214000040440400044114114111141141111411411114114117777777777777777777777777777777777777777
00000000111111111441144144114411112222114040400444000404141111411141141114111141114114117777777777777777777777777777777777777777
00000000444444454444444550555555111111155505550511115505144445455550500144445455555505005055111177777777777777777777777777777777
00000000400000504555555050555555111111155505550511115500144445455550500144445455555505000055111177777777777777777777777777777777
00000000405555404554455050555555111111155050550011110055144445455550500144445455555505005500111177777777777777777777777777777777
00000000405555404545505000000000111111100555005511110555144445455550500144445455555505005550111177777777777777777777777777777777
00000000405555404545505055555055111111150555055511110555144445455550500144445455555505005550111177777777777777777777777777777777
00000000405555404550055055555055111111150550055511115050144445455550500144445455555505000505111177777777777777777777777777777777
00000000454444404555555055555055111111155005505011115505144445455550500144445455555505005055111177777777777777777777777777777777
00000000500000005000000000000000111111105505550511115505144445455550500100000000000000005055111177777777777777777777777777777777
00000000111111111115551111000111111411117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000114455111155555510040011110501117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000144445511114044100040001105550117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000144445511114411104440501455555417777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000144445511000000100000001105550117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000144445511455554110050011110501117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000114455111551155111000111111411117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000111111111441144111111111111111117777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777770077777770077777007777770007777700077777707777770707777700077777000777770707777707777777070777770707777770777777
00000000070777770707777707777777070777770777777707777777070777770707777770777777770777770707777707777777000777770007777707077777
00000000070777770707777707777777070777770777777707777777077777770707777770777777770777770707777707777777000777770007777707077777
00000000000777770077777707777777070777770077777700777777000777770007777770777777770777770077777707777777070777770007777707077777
00000000070777770707777707777777070777770777777707777777070777770707777770777777770777770707777707777777070777770007777707077777
00000000070777770707777707777777070777770777777707777777070777770707777770777777070777770707777707777777070777770007777707077777
00000000070777770077777770077777007777770007777707777777707777770707777700077777707777770707777700077777070777770707777770777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777770077777770077777000777770707777707077777070777770707777707077777000777777777777777777777777777777777777777777777
00000000070777770707777707777777707777770707777707077777070777770707777707077777770777777777777777777777777777777777777777777777
00000000070777770707777707777777707777770707777707077777070777770707777770777777770777777777777777777777777777777777777777777777
00000000070777770077777770777777707777770707777707077777070777777077777770777777707777777777777777777777777777777777777777777777
00000000070777770707777777077777707777770707777707077777000777770707777770777777077777777777777777777777777777777777777777777777
00000000007777770707777777077777707777770707777770777777000777770707777770777777077777777777777777777777777777777777777777777777
00000000700777770707777700777777707777777077777770777777070777770707777770777777000777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000000777777077777700077777000777770707777700077777000777770007777700077777000777777777777777777777777777777777777777777777
00000000070777777077777777077777770777770707777707777777077777777707777707077777070777777777777777777777777777777777777777777777
00000000070777777077777777077777770777770707777707777777077777777707777707077777070777777777777777777777777777777777777777777777
00000000070777777077777700077777000777770007777700077777000777777707777700077777000777777777777777777777777777777777777777777777
00000000070777777077777707777777770777777707777777077777070777777707777707077777770777777777777777777777777777777777777777777777
00000000070777777077777707777777770777777707777777077777070777777707777707077777770777777777777777777777777777777777777777777777
00000000000777777077777700077777000777777707777700077777000777777707777700077777000777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111010111110101011111010101111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1101110111011101110101110111010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1105110111011101110101110111020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111010111110101110101110101110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
110111011121110111191a110101011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1101110111211101111718110107011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111010111011101011111010111110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1615151515151515151515151515151b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
